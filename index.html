<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÙˆØ±Ù‚Ø© Ø´ÙØ±Ø© - Ù†Ø³Ø®Ø© Ù‡ÙŠÙƒØ§</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Cairo:wght@400;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0f172a; --card-default: #ffffff;
            --team1-color: #2563eb; --team2-color: #dc2626;
            --neutral-color: #000000; --bomb-color: #10b981;
            --text-dark: #1e293b; --accent-color: #fbbf24;
            --revealed-mark: #ffff00;
        }

        body {
            font-family: 'Cairo', sans-serif; background-color: var(--bg-color); color: white;
            margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; min-height: 100vh;
        }

        .lobby-box {
            background: #1e293b; padding: 30px; border-radius: 25px; border: 2px solid var(--accent-color);
            text-align: center; margin-top: 40px; width: 90%; max-width: 450px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .main-btn { width: 100%; padding: 15px; margin: 10px 0; border-radius: 15px; border: none; font-size: 1.2rem; font-weight: 900; cursor: pointer; transition: 0.2s; }
        .btn-local { background: #6366f1; color: white; }
        .btn-online { background: var(--accent-color); color: black; }
        input { padding: 12px; border-radius: 10px; border: none; width: 85%; margin: 10px 0; text-align: center; font-size: 1.1rem; }

        .role-selector { display: flex; gap: 10px; margin: 15px 0; }
        .role-btn { flex: 1; padding: 12px; border-radius: 12px; border: 2px solid transparent; cursor: pointer; font-weight: 800; background: #334155; color: white; }
        .role-btn.active { border-color: var(--accent-color); background: rgba(251, 191, 36, 0.4); color: var(--accent-color); }

        #gameArea { display: none; width: 100%; flex-direction: column; align-items: center; }
        .timer-ui { background: rgba(0,0,0,0.4); padding: 10px 20px; border-radius: 20px; border: 2px solid var(--accent-color); margin-bottom: 10px; }
        #timerDisplay { font-size: 2rem; font-weight: 900; color: var(--accent-color); font-family: monospace; }
        .stats { background: rgba(255,255,255,0.1); padding: 10px 25px; border-radius: 50px; display: flex; gap: 30px; margin-bottom: 15px; font-weight: 900; font-size: 1.2rem; }
        .controls { display: flex; gap: 8px; margin-bottom: 15px; flex-wrap: wrap; justify-content: center; }
        .ctrl-btn { padding: 10px 18px; border-radius: 12px; border: none; font-weight: 800; cursor: pointer; font-size: 0.9rem; }

        .grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; width: 100%; max-width: 1000px; }
        .card {
            background-color: var(--card-default); color: var(--text-dark); height: 130px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border-radius: 15px; box-shadow: 0 4px 0px #cbd5e1; cursor: pointer; user-select: none; transition: 0.3s;
            position: relative; overflow: hidden;
        }
    /* fullscreen-mode adjustments: keep scroll, use 4 columns for phones, smaller cards */
    #gameArea.fs-mode { padding: 8px; height: 100vh; overflow: auto; -webkit-overflow-scrolling: touch; }
    /* Prefer 5 columns in fullscreen mode so more cards fit across the width */
    #gameArea.fs-mode .grid { transition: transform 0.18s ease; transform-origin: top center; width: 100%; max-width: 1000px; grid-template-columns: repeat(5, 1fr) !important; }
    #gameArea.fs-mode .card { height: 84px; border-radius: 10px; }
    #gameArea.fs-mode .emoji { font-size: 1.6rem; }
    #gameArea.fs-mode .word { font-size: 0.9rem; }
        .emoji { font-size: 2.8rem; line-height: 1; margin-bottom: 5px; }
        .word { font-size: 1.1rem; font-weight: 900; }

        .master-view .card.team1 { background-color: var(--team1-color) !important; color: white !important; border: 2px solid #fff; }
        .master-view .card.team2 { background-color: var(--team2-color) !important; color: white !important; border: 2px solid #fff; }
        .master-view .card.neutral { background-color: var(--neutral-color) !important; color: white !important; border: 1px solid #444; }
        .master-view .card.bomb { background-color: var(--bomb-color) !important; color: white !important; border: 2px solid #fff; }

        .master-view .card.revealed::after {
            content: ""; position: absolute; bottom: 0; left: 0; width: 100%; height: 12px;
            background-color: var(--revealed-mark); box-shadow: 0 -2px 10px rgba(255,255,0,0.8);
        }

        .card.revealed.team1 { background-color: var(--team1-color) !important; color: white !important; box-shadow: none; transform: translateY(4px); }
        .card.revealed.team2 { background-color: var(--team2-color) !important; color: white !important; box-shadow: none; transform: translateY(4px); }
        .card.revealed.neutral { background-color: var(--neutral-color) !important; color: white !important; box-shadow: none; transform: translateY(4px); }
        .card.revealed.bomb { background-color: var(--bomb-color) !important; color: white !important; box-shadow: none; transform: translateY(4px); }

        .footer-heka { margin-top: 20px; font-family: 'Pacifico', cursive; font-size: 2.2rem; color: var(--accent-color); opacity: 0.6; }
        .return-footer { background: transparent; color: #64748b; border: 1px solid #334155; margin: 20px 0; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: bold; }
        
        @media (max-width: 700px) { .grid { grid-template-columns: repeat(3, 1fr); } .card { height: 110px; } }
    </style>
</head>
<body>

    <div id="mainLobby" class="lobby-box">
        <h1 style="color:var(--accent-color); margin-bottom:20px;">ğŸ§  ÙˆØ±Ù‚Ø© Ø´ÙØ±Ø©</h1>
        <button class="main-btn btn-local" onclick="startLocal()">Ù„Ø¹Ø¨ Ù…Ø­Ù„ÙŠ (Local) ğŸ </button>
        <button class="main-btn btn-online" onclick="showOnlineMenu()">Ù„Ø¹Ø¨ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† (Online) ğŸŒ</button>
    </div>

    <div id="onlineMenu" class="lobby-box" style="display:none;">
        <h2 style="color:var(--accent-color)">Ø¯Ø®ÙˆÙ„ Ø§Ù„ØºØ±ÙØ© ğŸŒ</h2>
        <input type="text" id="roomInput" placeholder="Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ© (Ù…Ø«Ù„Ø§Ù‹ heka7)">
        <p>Ø§Ø®ØªØ§Ø± Ø¯ÙˆØ±Ùƒ:</p>
        <div class="role-selector">
            <button id="roleMaster" class="role-btn" onclick="setRole('master')">Ø³ÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯ ğŸ•¶ï¸</button>
            <button id="roleExplorer" class="role-btn active" onclick="setRole('explorer')">Ù…Ø³ØªÙƒØ´Ù ğŸ•µï¸â€â™‚ï¸</button>
        </div>
        <button class="main-btn btn-online" onclick="joinOnline()">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù†</button>
        <button style="background:transparent; color:white; border:none; cursor:pointer;" onclick="location.reload()">Ø±Ø¬ÙˆØ¹ ğŸ </button>
    </div>

    <div id="gameArea">
        <h2 id="roomLabel" style="color:var(--accent-color); margin:5px;"></h2>

        <div id="localTimer" class="timer-ui">
            <span id="timerDisplay">01:00</span>
            <div style="margin-top:5px">
                <button onclick="controlTimer('start')">â–¶ï¸</button>
                <button onclick="controlTimer('reset')">ğŸ”„</button>
            </div>
        </div>

        <div class="stats">
            <div id="bLeft" style="color:#60a5fa">ğŸ”µ: 9</div>
            <div id="rLeft" style="color:#f87171">ğŸ”´: 8</div>
        </div>

        <div class="controls">
            <button class="ctrl-btn" style="background:#10b981; color:white;" onclick="resetGameAction()">Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø© ğŸ”„</button>
            <button class="ctrl-btn" style="background:#6366f1; color:white;" onclick="toggleFS()">Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© ğŸ“º</button>
            <button id="btnMasterToggle" class="ctrl-btn" style="background:#f59e0b; color:black;" onclick="toggleMasterView()">ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ ğŸ•¶ï¸</button>
        </div>

        <div id="gameBoard" class="grid"></div>
        
        <div class="footer-heka">heka</div>
        
        <button class="return-footer" onclick="location.reload()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ğŸ </button>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCp9_P3K__Sr76iKgaVG1iD4NluUqPtni4",
            authDomain: "heka-codenames.firebaseapp.com",
            databaseURL: "https://heka-codenames-default-rtdb.firebaseio.com",
            projectId: "heka-codenames",
            storageBucket: "heka-codenames.firebasestorage.app",
            messagingSenderId: "901713932504",
            appId: "1:901713932504:web:7079662022a501e9c4e7ad"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let currentMode = "local", myRole = "explorer", roomId = "", timerInt, timeLeft = 60;
        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø© (ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¤Ù‡Ø§ Ø¨ÙƒÙ„Ù…Ø§ØªÙƒ Ø§Ù„Ù€ 300)
        const words = [
            {w: "Ø£Ø³Ø¯", e: "ğŸ¦"}, {w: "ÙÙŠÙ„", e: "ğŸ˜"}, {w: "Ø²Ø±Ø§ÙØ©", e: "ğŸ¦’"}, {w: "Ù†Ù…Ø±", e: "ğŸ¯"}, {w: "ØµÙ‚Ø±", e: "ğŸ¦…"},
            {w: "Ù‚Ø·Ø©", e: "ğŸ±"}, {w: "ÙƒÙ„Ø¨", e: "ğŸ¶"}, {w: "Ø­ØµØ§Ù†", e: "ğŸ´"}, {w: "Ø®Ø±ÙˆÙ", e: "ğŸ‘"}, {w: "Ø¬Ù…Ù„", e: "ğŸª"},
            {w: "Ø¯Ø¨", e: "ğŸ»"}, {w: "Ø£Ø±Ù†Ø¨", e: "ğŸ°"}, {w: "Ø«Ø¹Ù„Ø¨", e: "ğŸ¦Š"}, {w: "Ø°Ø¦Ø¨", e: "ğŸº"}, {w: "Ù‚Ø±Ø¯", e: "ğŸµ"},
            {w: "Ø®Ù†Ø²ÙŠØ±", e: "ğŸ·"}, {w: "Ø¨Ù‚Ø±Ø©", e: "ğŸ®"}, {w: "Ø­Ù…Ø§Ø±", e: "ğŸ¦“"}, {w: "ÙØ£Ø±", e: "ğŸ­"}, {w: "Ø³Ù†Ø¬Ø§Ø¨", e: "ğŸ¿ï¸"},
            {w: "Ø¨Ø·Ø©", e: "ğŸ¦†"}, {w: "Ø¯Ø¬Ø§Ø¬Ø©", e: "ğŸ”"}, {w: "Ø¨ÙˆÙ…Ø©", e: "ğŸ¦‰"}, {w: "Ø¨Ø·Ø±ÙŠÙ‚", e: "ğŸ§"}, {w: "Ø¨Ø¨ØºØ§Ø¡", e: "ğŸ¦œ"},
            {w: "Ø«Ø¹Ø¨Ø§Ù†", e: "ğŸ"}, {w: "ØªÙ…Ø³Ø§Ø­", e: "ğŸŠ"}, {w: "Ø³Ù„Ø­ÙØ§Ø©", e: "ğŸ¢"}, {w: "Ø¶ÙØ¯Ø¹", e: "ğŸ¸"}, {w: "Ø­ÙˆØª", e: "ğŸ‹"},
            {w: "Ø¯ÙˆÙ„ÙÙŠÙ†", e: "ğŸ¬"}, {w: "Ù‚Ø±Ø´", e: "ğŸ¦ˆ"}, {w: "Ø£Ø®Ø·Ø¨ÙˆØ·", e: "ğŸ™"}, {w: "Ù†Ø­Ù„Ø©", e: "ğŸ"}, {w: "Ù†Ù…Ù„Ø©", e: "ğŸœ"},
            {w: "ÙØ±Ø§Ø´Ø©", e: "ğŸ¦‹"}, {w: "Ø¹Ù†ÙƒØ¨ÙˆØª", e: "ğŸ•·ï¸"}, {w: "Ø¹Ù‚Ø±Ø¨", e: "ğŸ¦‚"}, {w: "ÙƒØ§Ù†Ø¬Ø±Ùˆ", e: "ğŸ¦˜"}, {w: "Ø¨Ø§Ù†Ø¯Ø§", e: "ğŸ¼"},
            {w: "ØªÙØ§Ø­", e: "ğŸ"}, {w: "Ù…ÙˆØ²", e: "ğŸŒ"}, {w: "Ø¹Ù†Ø¨", e: "ğŸ‡"}, {w: "Ø¨Ø·ÙŠØ®", e: "ğŸ‰"}, {w: "Ø¨Ø±ØªÙ‚Ø§Ù„", e: "ğŸŠ"},
            {w: "ÙØ±Ø§ÙˆÙ„Ø©", e: "ğŸ“"}, {w: "Ù…Ø§Ù†Ø¬Ùˆ", e: "ğŸ¥­"}, {w: "Ø£Ù†Ø§Ù†Ø§Ø³", e: "ğŸ"}, {w: "Ù„ÙŠÙ…ÙˆÙ†", e: "ğŸ‹"}, {w: "ÙƒØ±Ø²", e: "ğŸ’"},
            {w: "Ø¬ÙˆØ² Ø§Ù„Ù‡Ù†Ø¯", e: "ğŸ¥¥"}, {w: "ÙƒÙŠÙˆÙŠ", e: "ğŸ¥"}, {w: "Ø·Ù…Ø§Ø·Ù…", e: "ğŸ…"}, {w: "Ø®ÙŠØ§Ø±", e: "ğŸ¥’"}, {w: "Ø¬Ø²Ø±", e: "ğŸ¥•"},
            {w: "Ø¨ØµÙ„", e: "ğŸ§…"}, {w: "Ø«ÙˆÙ…", e: "ğŸ§„"}, {w: "Ø¨Ø·Ø§Ø·Ø³", e: "ğŸ¥”"}, {w: "Ø°Ø±Ø©", e: "ğŸŒ½"}, {w: "Ø¨Ø§Ø°Ù†Ø¬Ø§Ù†", e: "ğŸ†"},
            {w: "ÙÙ„ÙÙ„", e: "ğŸŒ¶"}, {w: "ÙØ·Ø±", e: "ğŸ„"}, {w: "Ø¨ÙŠØªØ²Ø§", e: "ğŸ•"}, {w: "Ø¨Ø±Ø¬Ø±", e: "ğŸ”"}, {w: "Ø¨Ø·Ø§Ø·Ø³ Ù…Ù‚Ù„ÙŠØ©", e: "ğŸŸ"},
            {w: "ØªØ§ÙƒÙˆ", e: "ğŸŒ®"}, {w: "Ø³ÙˆØ´ÙŠ", e: "ğŸ£"}, {w: "Ø¯Ø¬Ø§Ø¬", e: "ğŸ—"}, {w: "Ù„Ø­Ù…", e: "ğŸ¥©"}, {w: "Ø¨ÙŠØ¶", e: "ğŸ¥š"},
            {w: "Ø®Ø¨Ø²", e: "ğŸ"}, {w: "ÙƒØ±ÙˆØ§Ø³ÙˆÙ†", e: "ğŸ¥"}, {w: "ÙƒÙŠÙƒ", e: "ğŸ°"}, {w: "Ø¯ÙˆÙ†Ø§Øª", e: "ğŸ©"}, {w: "Ø´ÙˆÙƒÙˆÙ„Ø§ØªØ©", e: "ğŸ«"},
            {w: "Ø¢ÙŠØ³ ÙƒØ±ÙŠÙ…", e: "ğŸ¦"}, {w: "Ù‚Ù‡ÙˆØ©", e: "â˜•"}, {w: "Ø´Ø§ÙŠ", e: "ğŸµ"}, {w: "Ø¹ØµÙŠØ±", e: "ğŸ¹"}, {w: "Ø­Ù„ÙŠØ¨", e: "ğŸ¥›"},
            {w: "Ù…Ø§Ø¡", e: "ğŸ’§"}, {w: "Ø¹Ø³Ù„", e: "ğŸ¯"}, {w: "Ø³ÙƒØ±", e: "ğŸ¬"}, {w: "ÙØ´Ø§Ø±", e: "ğŸ¿"}, {w: "Ø¨Ø³ÙƒÙˆÙŠØª", e: "ğŸª"},
            {w: "Ø¬Ø¨Ù†Ø©", e: "ğŸ§€"}, {w: "Ø´ÙˆØ±Ø¨Ø©", e: "ğŸ¥£"}, {w: "Ù…ÙƒØ±ÙˆÙ†Ø©", e: "ğŸ"}, {w: "Ø£Ø±Ø²", e: "ğŸš"}, {w: "ÙØ¬Ù„", e: "ğŸ¥—"},
            {w: "Ø´Ù…Ø³", e: "â˜€ï¸"}, {w: "Ù‚Ù…Ø±", e: "ğŸŒ™"}, {w: "Ù†Ø¬Ù…Ø©", e: "â­"}, {w: "Ø³Ø­Ø§Ø¨", e: "â˜ï¸"}, {w: "Ù…Ø·Ø±", e: "ğŸŒ§ï¸"},
            {w: "Ø¨Ø±Ù‚", e: "âš¡"}, {w: "Ø«Ù„Ø¬", e: "â„ï¸"}, {w: "Ù†Ø§Ø±", e: "ğŸ”¥"}, {w: "Ø¨Ø­Ø±", e: "ğŸŒŠ"}, {w: "Ø¬Ø¨Ù„", e: "â›°ï¸"},
            {w: "Ø¨Ø±ÙƒØ§Ù†", e: "ğŸŒ‹"}, {w: "ØµØ­Ø±Ø§Ø¡", e: "ğŸœï¸"}, {w: "ØºØ§Ø¨Ø©", e: "ğŸŒ³"}, {w: "Ø¬Ø²ÙŠØ±Ø©", e: "ğŸï¸"}, {w: "Ø´Ù„Ø§Ù„", e: "ğŸï¸"},
            {w: "Ù†Ù‡Ø±", e: "ğŸï¸"}, {w: "Ø¥Ø¹ØµØ§Ø±", e: "ğŸŒªï¸"}, {w: "Ù‚ÙˆØ³ Ù‚Ø²Ø­", e: "ğŸŒˆ"}, {w: "Ù†Ø®Ù„Ø©", e: "ğŸŒ´"}, {w: "ØµØ¨Ø§Ø±", e: "ğŸŒµ"},
            {w: "ÙˆØ±Ø¯Ø©", e: "ğŸŒ¹"}, {w: "Ø´Ø¬Ø±Ø©", e: "ğŸŒ²"}, {w: "Ø®Ø±ÙŠÙ", e: "ğŸ‚"}, {w: "Ø¨Ù„ÙˆØ±Ù‡", e: "ğŸ”®"}, {w: "ØµØ®Ø±Ø©", e: "ğŸª¨"},
            {w: "Ù„ÙŠÙ„", e: "ğŸŒƒ"}, {w: "Ù†Ù‡Ø§Ø±", e: "ğŸ™ï¸"}, {w: "Ø¨Ø±ÙƒØ©", e: "ğŸŸ¦"}, {w: "Ù…ÙˆØ¬Ø©", e: "ğŸŒŠ"}, {w: "ÙƒÙˆÙƒØ¨", e: "ğŸª"},
            {w: "ÙØ¬Ø±", e: "ğŸŒ„"}, {w: "ØºØ±ÙˆØ¨", e: "ğŸŒ‡"}, {w: "Ø¶Ø¨Ø§Ø¨", e: "ğŸŒ«ï¸"}, {w: "ØºØµÙ†", e: "ğŸŒ¿"}, {w: "Ø¨Ø±Ø³ÙŠÙ…", e: "ğŸ€"},
            {w: "Ù‡Ø§ØªÙ", e: "ğŸ“±"}, {w: "ÙƒÙ…Ø¨ÙŠÙˆØªØ±", e: "ğŸ’»"}, {w: "Ø³Ø§Ø¹Ø©", e: "âŒš"}, {w: "ÙƒØ§Ù…ÙŠØ±Ø§", e: "ğŸ“·"}, {w: "ØªÙ„ÙØ²ÙŠÙˆÙ†", e: "ğŸ“º"},
            {w: "Ø³Ù…Ø§Ø¹Ø§Øª", e: "ğŸ§"}, {w: "Ù…Ø°ÙŠØ§Ø¹", e: "ğŸ“»"}, {w: "Ù…ØµØ¨Ø§Ø­", e: "ğŸ’¡"}, {w: "Ø¨Ø·Ø§Ø±ÙŠØ©", e: "ğŸ”‹"}, {w: "Ø´Ø§Ø­Ù†", e: "ğŸ”Œ"},
            {w: "Ù…ÙØªØ§Ø­", e: "ğŸ”‘"}, {w: "Ù‚ÙÙ„", e: "ğŸ”’"}, {w: "Ù…Ø·Ø±Ù‚Ø©", e: "ğŸ”¨"}, {w: "Ù…ÙÙƒ", e: "ğŸ”§"}, {w: "ÙØ£Ø³", e: "ğŸª“"},
            {w: "Ù…Ù‚Øµ", e: "âœ‚ï¸"}, {w: "Ù‚Ù„Ù…", e: "âœï¸"}, {w: "ÙƒØªØ§Ø¨", e: "ğŸ“–"}, {w: "Ø´Ù†Ø·Ø©", e: "ğŸ’"}, {w: "Ù†Ø¸Ø§Ø±Ø©", e: "ğŸ‘“"},
            {w: "ØªØ§Ø¬", e: "ğŸ‘‘"}, {w: "Ø®Ø§ØªÙ…", e: "ğŸ’"}, {w: "Ù‡Ø¯ÙŠØ©", e: "ğŸ"}, {w: "ÙÙ„ÙˆØ³", e: "ğŸ’°"}, {w: "ÙƒØ£Ø³", e: "ğŸ†"},
            {w: "Ø®Ø±ÙŠØ·Ø©", e: "ğŸ—ºï¸"}, {w: "Ø¨ÙˆØµÙ„Ø©", e: "ğŸ§­"}, {w: "Ø¨Ø±Ø¬", e: "ğŸ—¼"}, {w: "Ù‚Ù†Ø¨Ù„Ø©", e: "ğŸ’£"}, {w: "Ø³ÙŠÙ", e: "âš”ï¸"},
            {w: "Ø¯Ø±Ø¹", e: "ğŸ›¡ï¸"}, {w: "Ù…Ø¸Ù„Ø©", e: "â˜‚ï¸"}, {w: "Ø·Ø¨Ù„Ù‡", e: "ğŸ¥"}, {w: "ØµØ§Ø¨ÙˆÙ†", e: "ğŸ§¼"}, {w: "ÙÙˆØ·Ø©", e: "ğŸ§»"},
            {w: "ØºØ³Ø§Ù„Ø©", e: "ğŸ§º"}, {w: "Ù…ÙƒÙ†Ø³Ø©", e: "ğŸ§¹"}, {w: "Ù…Ø³Ù…Ø§Ø±", e: "ğŸ“"}, {w: "Ø³Ø¨Ø­Ø©", e: "ğŸ“¿"}, {w: "ØµÙ†Ø¯ÙˆÙ‚", e: "ğŸ“¦"},
            {w: "ÙˆØ±Ù‚Ø©", e: "ğŸ“„"}, {w: "Ù…Ø¸Ø±ÙˆÙ", e: "âœ‰ï¸"}, {w: "ÙƒØ±Ø³ÙŠ", e: "ğŸª‘"}, {w: "Ø·Ø§ÙˆÙ„Ø©", e: "ğŸ½ï¸"}, {w: "Ø³Ø±ÙŠØ±", e: "ğŸ›ï¸"},
            {w: "Ø¨ÙŠØ§Ù†Ùˆ", e: "ğŸ¹"}, {w: "Ø¨Ø§Ø¨", e: "ğŸšª"}, {w: "Ù…Ø±ÙˆØ­Ø©", e: "ğŸŒ€"}, {w: "Ø±Ù…Ù„", e: "â³"}, {w: "ØµØ§ÙØ±Ø©", e: "ğŸ“£"},
            {w: "ÙƒØ±Ø© Ù‚Ø¯Ù…", e: "âš½"}, {w: "ÙƒØ±Ø© Ø³Ù„Ø©", e: "ğŸ€"}, {w: "ØªÙ†Ø³", e: "ğŸ¾"}, {w: "Ø³Ø¨Ø§Ø­Ø©", e: "ğŸŠ"}, {w: "Ø¯Ø±Ø§Ø¬Ø©", e: "ğŸš²"},
            {w: "Ø³ÙŠØ§Ø±Ø©", e: "ğŸš—"}, {w: "Ø·Ø§Ø¦Ø±Ø©", e: "âœˆï¸"}, {w: "Ø³ÙÙŠÙ†Ø©", e: "ğŸš¢"}, {w: "Ù‚Ø·Ø§Ø±", e: "ğŸš†"}, {w: "ØµØ§Ø±ÙˆØ®", e: "ğŸš€"},
            {w: "Ù‡Ù„ÙŠÙƒÙˆØ¨ØªØ±", e: "ğŸš"}, {w: "ØªÙˆÙƒ ØªÙˆÙƒ", e: "ğŸ›º"}, {w: "Ù…ÙˆØªÙˆØ³ÙŠÙƒÙ„", e: "ğŸï¸"}, {w: "Ø´Ø§Ø­Ù†Ø©", e: "ğŸš›"}, {w: "Ø­Ø§ÙÙ„Ø©", e: "ğŸšŒ"},
            {w: "ØªØ§ÙƒØ³ÙŠ", e: "ğŸš•"}, {w: "Ø¥Ø³Ø¹Ø§Ù", e: "ğŸš‘"}, {w: "Ù…Ø·Ø§ÙØ¦", e: "ğŸš’"}, {w: "Ø¬Ø±Ø§Ø±", e: "ğŸšœ"}, {w: "Ù…Ø¶Ø±Ø¨", e: "ğŸ“"},
            {w: "Ù…Ù„Ø§ÙƒÙ…Ø©", e: "ğŸ¥Š"}, {w: "ØªØ²Ù„Ø¬", e: "â›¸ï¸"}, {w: "ÙƒÙˆØªØ´ÙŠÙ†Ø©", e: "ğŸƒ"}, {w: "Ù†Ø±Ø¯", e: "ğŸ²"}, {w: "Ø´Ø·Ø±Ù†Ø¬", e: "â™Ÿï¸"},
            {w: "Ø¨Ù„ÙŠØ§Ø±Ø¯Ùˆ", e: "ğŸ±"}, {w: "ØµÙŠØ¯", e: "ğŸ£"}, {w: "ØªØ®ÙŠÙŠÙ…", e: "â›º"}, {w: "Ø¬Ø±ÙŠ", e: "ğŸƒ"}, {w: "Ø³ÙØ±", e: "âœˆï¸"},
            {w: "ØªØ°ÙƒØ±Ø©", e: "ğŸŸï¸"}, {w: "Ù…ÙŠØ¯Ø§Ù„ÙŠØ©", e: "ğŸ¥‡"}, {w: "Ù‚ÙØ§Ø² Ù…Ù„Ø§ÙƒÙ…Ø©", e: "ğŸ¥Š"}, {w: "Ø¨Ø§Ù„ÙˆÙ†", e: "ğŸˆ"}, {w: "Ù…Ù„Ø¹Ø¨", e: "ğŸŸï¸"},
            {w: "Ø·Ø¨ÙŠØ¨", e: "ğŸ‘¨â€âš•ï¸"}, {w: "Ù…Ù‡Ù†Ø¯Ø³", e: "ğŸ‘·"}, {w: "Ø´Ø±Ø·ÙŠ", e: "ğŸ‘®"}, {w: "Ø·Ø¨Ø§Ø®", e: "ğŸ‘¨â€ğŸ³"}, {w: "Ø·ÙŠØ§Ø±", e: "ğŸ‘¨â€âœˆï¸"},
            {w: "Ù…Ø¹Ù„Ù…", e: "ğŸ‘¨â€ğŸ«"}, {w: "ÙÙ†Ø§Ù†", e: "ğŸ‘¨â€ğŸ¨"}, {w: "Ø±Ø§Ø¦Ø¯ ÙØ¶Ø§Ø¡", e: "ğŸ‘¨â€ğŸš€"}, {w: "Ù‚Ø§Ø¶ÙŠ", e: "âš–ï¸"}, {w: "Ù…Ø²Ø§Ø±Ø¹", e: "ğŸ‘¨â€ğŸŒ¾"},
            {w: "Ù…Ù„Ùƒ", e: "ğŸ‘‘"}, {w: "Ù‡ÙƒØ±", e: "ğŸ‘¨â€ğŸ’»"}, {w: "Ù…ØºÙ†ÙŠ", e: "ğŸ‘¨â€ğŸ¤"}, {w: "Ù…Ø­Ø§Ù…ÙŠ", e: "ğŸ‘¨â€âš–ï¸"}, {w: "Ø¨Ø­Ø§Ø±", e: "âš“"},
            {w: "Ø±Ø¬Ù„ Ø¢Ù„ÙŠ", e: "ğŸ¤–"}, {w: "ÙØ¶Ø§Ø¦ÙŠ", e: "ğŸ›¸"}, {w: "Ø´Ø¨Ø­", e: "ğŸ‘»"}, {w: "ØªÙ†ÙŠÙ†", e: "ğŸ²"}, {w: "Ø­ÙˆØ±ÙŠØ©", e: "ğŸ§œâ€â™€ï¸"},
            {w: "Ø³Ø§Ø­Ø±", e: "ğŸ§™â€â™‚ï¸"}, {w: "Ù…ÙˆÙ…ÙŠØ§Ø¡", e: "ğŸ§Ÿ"}, {w: "Ù‡ÙŠÙƒÙ„ Ø¹Ø¸Ù…ÙŠ", e: "ğŸ’€"}, {w: "Ù‚Ù„Ø¨", e: "â¤ï¸"}, {w: "Ø¹ÙŠÙ†", e: "ğŸ‘ï¸"},
            {w: "ÙŠØ¯", e: "âœ‹"}, {w: "Ø·ÙÙ„", e: "ğŸ‘¶"}, {w: "Ø¹Ø§Ø¦Ù„Ø©", e: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦"}, {w: "Ø¨ØµÙ…Ø©", e: "ğŸ‘£"}, {w: "Ø¹Ø¶Ù„Ø§Øª", e: "ğŸ¦¾"},
            {w: "Ø¯Ù…Ø§Øº", e: "ğŸ§ "}, {w: "Ø±Ø¬Ù„", e: "ğŸ‘¨"}, {w: "Ø§Ù…Ø±Ø£Ø©", e: "ğŸ‘©"}, {w: "Ø¬Ø¯", e: "ğŸ‘´"}, {w: "Ø¬Ø¯Ø©", e: "ğŸ‘µ"},
            {w: "Ù‚Ù…ÙŠØµ", e: "ğŸ‘•"}, {w: "Ø¨Ù†Ø·Ù„ÙˆÙ†", e: "ğŸ‘–"}, {w: "ÙØ³ØªØ§Ù†", e: "ğŸ‘—"}, {w: "Ø­Ø°Ø§Ø¡", e: "ğŸ‘"}, {w: "Ù‚Ø¨Ø¹Ø©", e: "ğŸ§¢"},
            {w: "Ø¬ÙˆØ±Ø¨", e: "ğŸ§¦"}, {w: "Ø³ØªØ±Ø©", e: "ğŸ§¥"}, {w: "Ù†Ø¸Ø§Ø±Ø© Ø´Ù…Ø³", e: "ğŸ•¶ï¸"}, {w: "Ù…Ø³ØªØ´ÙÙ‰", e: "ğŸ¥"}, {w: "Ù…Ø¯Ø±Ø³Ø©", e: "ğŸ«"},
            {w: "Ù…Ù†Ø²Ù„", e: "ğŸ "}, {w: "Ù…Ø³Ø¬Ø¯", e: "ğŸ•Œ"}, {w: "ÙƒÙ†ÙŠØ³Ø©", e: "â›ª"}, {w: "Ø¨Ù†Ùƒ", e: "ğŸ¦"}, {w: "Ù…Ø·Ø¹Ù…", e: "ğŸ´"},
            {w: "Ø³ÙŠÙ†Ù…Ø§", e: "ğŸ¬"}, {w: "Ù…Ø·Ø§Ø±", e: "ğŸ›«"}, {w: "Ù‚Ù„Ø¹Ø©", e: "ğŸ°"}, {w: "Ù…ÙƒØªØ¨Ø©", e: "ğŸ“š"}, {w: "Ø³ÙˆÙ‚", e: "ğŸ›’"},
            {w: "ØµÙŠØ¯Ù„ÙŠØ©", e: "ğŸ’Š"}, {w: "Ù‚Ø³Ù… Ø´Ø±Ø·Ø©", e: "ğŸš“"}, {w: "Ù…ÙƒØªØ¨", e: "ğŸ¢"}, {w: "Ø­Ø¯ÙŠÙ‚Ø©", e: "ğŸ¡"}, {w: "ÙÙ†Ø¯Ù‚", e: "ğŸ¨"},
            {w: "Ù…Ø®Ø¨Ø²", e: "ğŸ¥–"}, {w: "Ù…ØªØ­Ù", e: "ğŸ–¼ï¸"}, {w: "Ø³ÙŠØ±Ùƒ", e: "ğŸª"}, {w: "Ù…Ù„Ø§Ù‡ÙŠ", e: "ğŸ¡"}, {w: "Ø¬Ø³Ø±", e: "ğŸŒ‰"},
            {w: "Ø·Ø±ÙŠÙ‚", e: "ğŸ›£ï¸"}, {w: "Ù…ØµÙ†Ø¹", e: "ğŸ­"}, {w: "Ù…Ø®ÙŠÙ…", e: "â›º"}, {w: "Ø­Ù…Ø§Ù…", e: "ğŸš¿"}, {w: "Ø³Ø¬Ø§Ø¦Ø±", e: "ğŸš¬"},
            {w: "Ù…Ù†Ø´Ø§Ø±", e: "ğŸªš"}, {w: "Ù…Ù†Ø´Ø§Ø±", e: "ğŸªš"}
        ];
        

        function showOnlineMenu() { document.getElementById('mainLobby').style.display='none'; document.getElementById('onlineMenu').style.display='block'; }
        function setRole(r) { myRole = r; document.getElementById('roleMaster').classList.toggle('active', r==='master'); document.getElementById('roleExplorer').classList.toggle('active', r==='explorer'); }

        function startLocal() { currentMode = "local"; prepareUI(); resetLocalGame(); }

        function joinOnline() {
            roomId = document.getElementById('roomInput').value.trim();
            if(!roomId) return alert("ÙÙŠÙ† Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ©ØŸ");
            currentMode = "online"; prepareUI();
            db.ref('rooms/' + roomId).on('value', (snap) => {
                const data = snap.val();
                if(data && data.cards) {
                    renderBoard(data.cards);
                    document.getElementById('bLeft').innerText = `ğŸ”µ: ${data.bCount}`;
                    document.getElementById('rLeft').innerText = `ğŸ”´: ${data.rCount}`;
                    
                    // ÙØ­Øµ Ø§Ù„ÙÙˆØ² ÙÙŠ Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†
                    if(data.bCount === 0) { alert("ØªÙ‡Ø§Ù†ÙŠÙ†Ø§ Ù„Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ù‚! Ù„Ù‚Ø¯ ÙØ²ØªÙ… Ø¨Ø§Ù„Ù…Ù‡Ù…Ø©! ğŸ”µğŸ¥³"); }
                    if(data.rCount === 0) { alert("ØªÙ‡Ø§Ù†ÙŠÙ†Ø§ Ù„Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø­Ù…Ø±! Ù„Ù‚Ø¯ ÙØ²ØªÙ… Ø¨Ø§Ù„Ù…Ù‡Ù…Ø©! ğŸ”´ğŸ¥³"); }
                } else { resetOnlineGame(); }
            });
        }

        function prepareUI() {
            document.getElementById('mainLobby').style.display='none';
            document.getElementById('onlineMenu').style.display='none';
            document.getElementById('gameArea').style.display='flex';
            const board = document.getElementById('gameBoard');
            if(currentMode === "online") {
                document.getElementById('localTimer').style.display = 'none';
                document.getElementById('btnMasterToggle').style.display = 'none';
                document.getElementById('roomLabel').innerText = `ØºØ±ÙØ©: ${roomId}`;
                if(myRole === 'master') board.classList.add('master-view');
                else board.classList.remove('master-view');
            } else {
                document.getElementById('localTimer').style.display = 'block';
                document.getElementById('btnMasterToggle').style.display = 'inline-block';
                document.getElementById('roomLabel').innerText = "Ù„Ø¹Ø¨ Ù…Ø­Ù„ÙŠ";
                board.classList.remove('master-view');
            }
        }

        function resetGameAction() { if(currentMode === "local") resetLocalGame(); else resetOnlineGame(); }

        function resetLocalGame() {
            let s = [...words].sort(() => 0.5-Math.random()).slice(0, 25);
            let r = [...Array(9).fill('team1'), ...Array(8).fill('team2'), ...Array(7).fill('neutral'), 'bomb'].sort(() => 0.5-Math.random());
            let localCards = s.map((w, i) => ({w: w.w, e: w.e, r: r[i], v: false}));
            renderBoard(localCards);
            document.getElementById('bLeft').innerText = `ğŸ”µ: 9`; 
            document.getElementById('rLeft').innerText = `ğŸ”´: 8`;
            controlTimer('reset');
        }

        function resetOnlineGame() {
            let s = [...words].sort(() => 0.5 - Math.random()).slice(0, 25);
            let r = [...Array(9).fill('team1'), ...Array(8).fill('team2'), ...Array(7).fill('neutral'), 'bomb'].sort(() => 0.5 - Math.random());
            let cards = s.map((item, i) => ({w: item.w, e: item.e, r: r[i], v: false}));
            db.ref('rooms/' + roomId).set({ cards, bCount: 9, rCount: 8 });
        }

        function renderBoard(cards) {
            const b = document.getElementById('gameBoard'); b.innerHTML = '';
            cards.forEach((c, i) => {
                const d = document.createElement('div');
                d.className = `card ${c.r} ${c.v ? 'revealed' : ''}`;
                d.innerHTML = `<div class="emoji">${c.e}</div><div class="word">${c.w}</div>`;
                d.onclick = () => {
                    const isMasterView = b.classList.contains('master-view');
                    if(isMasterView) {
                        alert("ÙŠØ§ Ù‡ÙŠÙƒØ§ Ø£Ù†Øª Ø³ÙŠØ¯ ÙƒÙˆØ¯ØŒ Ø§Ù„Ù…Ø³ØªÙƒØ´Ù Ù‡Ùˆ Ø§Ù„Ù„ÙŠ Ø¨ÙŠÙØªØ­ Ø§Ù„ÙƒØ±ÙˆØª! ğŸ•¶ï¸");
                        return;
                    }
                    if(c.v) return;

                    if(currentMode === "online") {
                        db.ref(`rooms/${roomId}/cards/${i}`).update({v: true});
                        if(c.r === 'bomb') {
                            alert("Ø¨Ù€ÙˆÙˆÙˆÙ…! Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ù„ÙŠ Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ù†Ø¨Ù„Ø© Ø®Ø³Ø± Ø§Ù„Ø¬ÙŠÙ…! ğŸ’£ğŸ’¥");
                        } else {
                            let teamKey = c.r === 'team1' ? 'bCount' : (c.r === 'team2' ? 'rCount' : null);
                            if(teamKey) db.ref(`rooms/${roomId}/${teamKey}`).transaction(n => (n || 0) - 1);
                        }
                    } else {
                        // ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­Ù„ÙŠ (Local)
                        c.v = true;
                        if(c.r === 'bomb') { alert("Ø¨Ù€ÙˆÙˆÙˆÙ…! Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ù„ÙŠ Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ù†Ø¨Ù„Ø© Ø®Ø³Ø± Ø§Ù„Ø¬ÙŠÙ…! ğŸ’£ğŸ’¥"); }
                        renderBoard(cards);
                        
                        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹
                        let bRem = cards.filter(card => card.r === 'team1' && !card.v).length;
                        let rRem = cards.filter(card => card.r === 'team2' && !card.v).length;
                        document.getElementById('bLeft').innerText = `ğŸ”µ: ${bRem}`;
                        document.getElementById('rLeft').innerText = `ğŸ”´: ${rRem}`;
                        
                        if(bRem === 0) alert("ØªÙ‡Ø§Ù†ÙŠÙ†Ø§ Ù„Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ù‚! Ù„Ù‚Ø¯ ÙØ²ØªÙ… Ø¨Ø§Ù„Ù…Ù‡Ù…Ø©! ğŸ”µğŸ¥³");
                        if(rRem === 0) alert("ØªÙ‡Ø§Ù†ÙŠÙ†Ø§ Ù„Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø­Ù…Ø±! Ù„Ù‚Ø¯ ÙØ²ØªÙ… Ø¨Ø§Ù„Ù…Ù‡Ù…Ø©! ğŸ”´ğŸ¥³");
                    }
                };
                b.appendChild(d);
            });
        }

        function toggleMasterView() { document.getElementById('gameBoard').classList.toggle('master-view'); }
        function toggleFS() {
            const ga = document.getElementById('gameArea');
            // If fullscreen API exists, use it (requires user gesture)
            if (ga.requestFullscreen || ga.webkitRequestFullscreen || ga.msRequestFullscreen) {
                if (!document.fullscreenElement) {
                    if (ga.requestFullscreen) ga.requestFullscreen();
                    else if (ga.webkitRequestFullscreen) ga.webkitRequestFullscreen();
                    else if (ga.msRequestFullscreen) ga.msRequestFullscreen();
                } else {
                    if (document.exitFullscreen) document.exitFullscreen();
                    else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
                    else if (document.msExitFullscreen) document.msExitFullscreen();
                }
            } else {
                // fallback: toggle the fs-mode class even if browser doesn't support Fullscreen API (useful for some mobile browsers)
                if (!ga.classList.contains('fs-mode')) {
                    ga.classList.add('fs-mode');
                    setTimeout(() => computeAndApplyScale(), 60);
                } else {
                    ga.classList.remove('fs-mode');
                    const board = document.getElementById('gameBoard'); if (board) board.style.transform = '';
                }
            }
        }

        // When entering/exiting fullscreen or resizing, compute a scale to fit the board into the viewport
        function computeAndApplyScale() {
            const board = document.getElementById('gameBoard');
            const ga = document.getElementById('gameArea');
            if (!board) return;
            // If we're using fs-mode layout (4 columns + smaller cards), don't apply transform scaling
            if (ga && ga.classList.contains('fs-mode')) {
                // ensure no transform remains
                board.style.transform = '';
                board.style.webkitTransform = '';
                return;
            }

            // reset first so measurements are natural
            board.style.transform = '';

            // measure required size
            const rect = board.getBoundingClientRect();
            const gapVert = 20; // small buffer for headers/controls
            const availW = window.innerWidth - 20;
            const availH = window.innerHeight - gapVert - 20;

            // If board height is 0 (not rendered yet), skip
            if (rect.width === 0 || rect.height === 0) return;

            const scaleW = availW / rect.width;
            const scaleH = availH / rect.height;
            const scale = Math.min(1, scaleW, scaleH);

            board.style.transform = `scale(${scale})`;
            board.style.webkitTransform = `scale(${scale})`;
        }

        function applyFullscreenLayout() {
            const ga = document.getElementById('gameArea');
            const board = document.getElementById('gameBoard');
            if (document.fullscreenElement) {
                // mark gameArea to apply smaller sizing rules
                ga.classList.add('fs-mode');
                // small timeout to allow browser to enter fullscreen and recalc layout
                setTimeout(() => computeAndApplyScale(), 80);
            } else {
                ga.classList.remove('fs-mode');
                if (board) board.style.transform = '';
            }
        }

        // respond to fullscreen change and window resize
        document.addEventListener('fullscreenchange', applyFullscreenLayout);
        // vendor-specific events
        document.addEventListener('webkitfullscreenchange', applyFullscreenLayout);
        document.addEventListener('msfullscreenchange', applyFullscreenLayout);

        window.addEventListener('resize', () => { if (document.fullscreenElement) computeAndApplyScale(); });
        function controlTimer(action) {
            if(action === 'start') { clearInterval(timerInt); timerInt = setInterval(() => { if(timeLeft > 0) { timeLeft--; updateTimerUI(); } }, 1000); }
            else if(action === 'stop') { clearInterval(timerInt); }
            else { clearInterval(timerInt); timeLeft = 60; updateTimerUI(); }
        }
        function updateTimerUI() { let m = Math.floor(timeLeft/60).toString().padStart(2,'0'), s = (timeLeft%60).toString().padStart(2,'0'); document.getElementById('timerDisplay').innerText = `${m}:${s}`; }
    </script>
</body>
</html>
